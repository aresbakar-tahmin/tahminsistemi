
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Otomatik Tahmin Sistemi - Ares</title>
  <style>
    body {
      background: #0f0f0f;
      color: #f1f1f1;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      gap: 15px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
    }
    input {
      width: 200px;
      text-align: center;
    }
    button {
      background: #222;
      color: #00ff88;
      cursor: pointer;
    }
    button:hover {
      background: #00ff88;
      color: #000;
    }
    .box {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h2>ðŸ”® Otomatik Ã–ÄŸrenen Tahmin Sistemi</h2>
  <div class="box">
    <input type="number" id="gercek" placeholder="GerÃ§ek sayÄ±">
    <button id="tahminKaydet">Tahmin Et ve Kaydet</button>
    <p id="sonuc"></p>
  </div>

  <!-- ModÃ¼ler Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://tahminsistemi-ars2025-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const gercekInput = document.getElementById("gercek");
    const tahminKaydetBtn = document.getElementById("tahminKaydet");
    const sonucP = document.getElementById("sonuc");

    let sayac = 0;
    let sonTahminler = [];

    async function getSonTahminler() {
      const snapshot = await get(ref(db, "tahminler"));
      if (snapshot.exists()) {
        const data = Object.values(snapshot.val());
        return data.map(d => d.gercek);
      }
      return [];
    }

    tahminKaydetBtn.addEventListener("click", async () => {
      const gercek = parseFloat(gercekInput.value);
      if (isNaN(gercek)) {
        alert("LÃ¼tfen gerÃ§ek sayÄ±yÄ± gir!");
        return;
      }

      // Son tahminleri al (Firebaseâ€™den)
      let gecmisTahminler = await getSonTahminler();
      sonTahminler = gecmisTahminler.slice(-5); // son 5 kaydÄ± al

      // Trend hesapla
      let tahmin;
      if (sonTahminler.length === 0) {
        tahmin = gercek + (Math.random()*2 -1);
      } else {
        let toplamFark = 0;
        for (let i=1; i<sonTahminler.length; i++) {
          toplamFark += sonTahminler[i] - sonTahminler[i-1];
        }
        let trend = toplamFark / (sonTahminler.length-1 || 1);
        let sonDeger = sonTahminler[sonTahminler.length-1];
        tahmin = sonDeger + trend + (Math.random()*0.5 - 0.25);
      }

      // ðŸ”¹ Minimum sÄ±nÄ±r
      tahmin = Math.max(1, tahmin);

      sayac = sonTahminler.length + 1;
      const veri = {
        id: sayac,
        tahmin: tahmin,
        gercek: gercek,
        fark: Math.abs(tahmin - gercek),
        tarih: new Date().toLocaleString("tr-TR")
      };

      await set(ref(db, "tahminler/" + sayac), veri);

      sonucP.textContent = `ðŸ“Š Tahmin: ${tahmin.toFixed(3)} | âœ… KayÄ±t ${sayac} eklendi. Fark: ${veri.fark.toFixed(3)}`;

      gercekInput.value = "";
    });
  </script>
</body>
</html>