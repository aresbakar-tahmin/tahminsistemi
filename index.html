
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Otomatik Tahmin Sistemi - Ares</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #0f0f0f;
      color: #f1f1f1;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 20px;
      gap: 15px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
    }
    input {
      width: 150px;
      text-align: center;
    }
    button {
      background: #222;
      color: #00ff88;
      cursor: pointer;
    }
    button:hover {
      background: #00ff88;
      color: #000;
    }
    .box {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      width: 100%;
      max-width: 500px;
    }
    .satir {
      display: flex;
      justify-content: space-between;
      width: 100%;
      background: #222;
      padding: 5px 10px;
      border-radius: 6px;
    }
    canvas {
      background: #111;
      border-radius: 10px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>ðŸ”® Otomatik Ã–ÄŸrenen Tahmin Sistemi</h2>
  <div class="box">
    <div>
      GerÃ§ek sayÄ±: <input type="number" id="gercek" placeholder="GerÃ§ek sayÄ±">
      <button id="tahminKaydet">Tahmin Et ve Kaydet</button>
    </div>
    <div id="kayitlar"></div>
    <canvas id="grafik" width="400" height="200"></canvas>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      databaseURL: "https://tahminsistemi-ars2025-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const gercekInput = document.getElementById("gercek");
    const tahminKaydetBtn = document.getElementById("tahminKaydet");
    const kayitlarDiv = document.getElementById("kayitlar");

    let sonTahminler = [];

    async function getSonTahminler() {
      const snapshot = await get(ref(db, "tahminler"));
      if (snapshot.exists()) {
        const data = Object.values(snapshot.val());
        return data;
      }
      return [];
    }

    function guncelleKayitlar(veriler) {
      kayitlarDiv.innerHTML = "";
      veriler.forEach(v => {
        const div = document.createElement("div");
        div.className = "satir";
        div.textContent = `Tahmin: ${v.tahmin.toFixed(2)} | GerÃ§ek: ${v.gercek.toFixed(2)} | Fark: ${v.fark.toFixed(2)}`;
        kayitlarDiv.appendChild(div);
      });
    }

    // Grafik
    const ctx = document.getElementById('grafik').getContext('2d');
    let chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [
          { label: 'Tahmin', data: [], borderColor: 'cyan', tension: 0.3 },
          { label: 'GerÃ§ek', data: [], borderColor: 'lime', tension: 0.3 },
          { label: 'Fark', data: [], borderColor: 'orange', tension: 0.3 }
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: false, min: 0 } }
      }
    });

    async function guncelleGrafik(veriler) {
      const son20 = veriler.slice(-20);
      chart.data.labels = son20.map(v => v.id);
      chart.data.datasets[0].data = son20.map(v => v.tahmin);
      chart.data.datasets[1].data = son20.map(v => v.gercek);
      chart.data.datasets[2].data = son20.map(v => v.fark);
      chart.update();
    }

    tahminKaydetBtn.addEventListener("click", async () => {
      const gercek = parseFloat(gercekInput.value);
      if (isNaN(gercek)) { alert("GerÃ§ek sayÄ± gir!"); return; }

      let veriler = await getSonTahminler();
      sonTahminler = veriler.map(v => v.gercek).slice(-5);

      // Trend hesapla
      let tahmin;
      if (sonTahminler.length === 0) {
        tahmin = gercek + (Math.random()*2 -1);
      } else {
        let toplamFark = 0;
        for (let i=1; i<sonTahminler.length; i++) toplamFark += sonTahminler[i]-sonTahminler[i-1];
        let trend = toplamFark / (sonTahminler.length-1 || 1);
        let sonDeger = sonTahminler[sonTahminler.length-1];
        tahmin = sonDeger + trend + (Math.random()*0.5 - 0.25);
      }

      // Minimum 1
      tahmin = Math.max(1, tahmin);

      // ID artÄ±ÅŸÄ±
      const sonId = veriler.length;
      const yeniId = sonId + 1;

      const veri = {
        id: yeniId,
        tahmin: tahmin,
        gercek: gercek,
        fark: Math.abs(tahmin - gercek),
        tarih: new Date().toLocaleString("tr-TR")
      };

      await set(ref(db, "tahminler/" + yeniId), veri);

      // GÃ¶rÃ¼nÃ¼m gÃ¼ncelle
      veriler.push(veri);
      guncelleKayitlar(veriler);
      guncelleGrafik(veriler);

      gercekInput.value = "";
    });
  </script>
</body>
</html>